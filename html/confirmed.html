<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>confirmed</title>
    <link rel="stylesheet" href="/styling/style.css">
    <!-- <link rel="stylesheet" href="/styling/profile.css"> -->
    <script src="https://kit.fontawesome.com/9339802a43.js" crossorigin="anonymous"></script>
</head>
<style>
    .back {
   display: flex;
   position: absolute;
   align-self: flex-start;
   text-decoration: none;
   margin-top: 30px;
   margin-left: 30px;
   left: 0;
}
.contents {
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center ;
    margin: 40px 20px 10px 20px;
    
}
.info {
    display: flex;
    justify-content: space-between;
    background-color: #FBEEDF;
    margin: 2px;
    padding: 0px 20px;
}
.carpooling, .payment {
    width: 50%;
    display: flex;
    flex-direction: column;
    
}
#book {
    display: flex;
    justify-content: center;
    align-self: center;
    background-color: #E99060;
    padding: 10px;
    width: 100px;
    border: none;
    border-radius: 30px;
    font-weight: 700;
}
</style>
<body>
    <nav>
        <div class="logo">
            <img class="logoImg" src="/src/tara rent.png" width="50px" height="50px">
            <p class="logoName">TARA RENT</p>
        </div>
        <div class="user">
           <a href="profile.html" target="_self" >
            <i class="fa-regular fa-user fa-2x" style="color: #131415;"> </i>
           </a> 
        </div>
        
    </nav>

    <a href="cars.html" class="back" id="back"> <i class="fa-solid fa-arrow-left fa-2x" style="color: #f49060;"></i></a>

    <div class="contents">
        <h1> Confirm Booking</h1>
        <hr style="margin: 10px 30px;">
        <h2> Carpooling Details</h2>
        <div class="carpooling">
            <div class="info">
                <p>Car </p>
                <p id="car"></p>
            </div>
            <div class="info">
                <p>Destination</p>
                <p id="place"></p>
            </div>
            <div class="info">
                <p>Event</p>
                <p id="eventName"></p>
            </div>
            <div class="info">
                <p> Departure</p>
                <p id="dateFrom"></p>
            </div>
            <div class="info">
                <p>Name of Driver</p>
                <p id="driver"></p>
            </div>
            <div class="info">
                <p>Pax</p>
                <p id="pax">1</p>
            </div>
        </div>
        <h2 class="Payment">Payment</h2>
        <div class="payment">
            <div class="info">
                <p>Subtotal:</p>
                <p id="price"></p>
            </div>
            <div class="info">
                <p>Total:</p>
                <p id="Totalprice"></p>
            </div>
            <p>*The payment will be paid upon the day of the departure</p>
        </div>
        <Button id="book">Book now</Button>
    </div>
    

<script type="module" >
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.10.0/firebase-app.js";
    import { getDatabase, ref, set } from "https://www.gstatic.com/firebasejs/10.10.0/firebase-database.js";

    const firebaseConfig = {
        apiKey: "AIzaSyBAntVFheC4AyJ5n6BGMvZzbfJtisDGafw",
        authDomain: "admintararent.firebaseapp.com",
        databaseURL: "https://admintararent-default-rtdb.asia-southeast1.firebasedatabase.app",
        projectId: "admintararent",
        storageBucket: "admintararent.appspot.com",
        messagingSenderId: "419063988334",
        appId: "1:419063988334:web:c2e91de332e34e53c6267f",
        measurementId: "G-619H3PF5LZ"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    let userCreds = JSON.parse(sessionStorage.getItem("user-creds"));
    let userInfo = JSON.parse(sessionStorage.getItem("user-info"));
    let eventSelected = JSON.parse(sessionStorage.getItem("Event-selected"));
    let carSelected = JSON.parse(sessionStorage.getItem("car-selected"));
    let carDriverSelected = JSON.parse(sessionStorage.getItem("carDriver-selected"));

    
    const back = document.getElementById('back');
    
    let carName = document.getElementById("car");
    let Totalprice = document.getElementById("Totalprice");
    let price = document.getElementById("price");
    let place = document.getElementById("place");
    let eventName = document.getElementById("eventName");
    let dateFrom = document.getElementById("dateFrom");
    let driverName = document.getElementById("driver");
    let pax = document.getElementById("pax").value;

    let book = document.getElementById("book");
   
    
    back.addEventListener('click', () => {
            sessionStorage.removeItem(eventSelected);
            sessionStorage.removeItem(carSelected);
            window.location.href = "index.html";
        });


        console.log(carSelected);
        console.log(eventSelected);
        console.log(carDriverSelected);
        console.log(userCreds.uid);

        const userUid = userCreds.uid;

        carName.innerText = `${carSelected.modelName}`;
        place.innerText = `${eventSelected.eventVenue}`;
        eventName.innerText = `${eventSelected.eventName}`;
        dateFrom.innerText = `${eventSelected.eventDateFrom}`;
        driverName.innerText = carDriverSelected;
        price.innerText = `${eventSelected.eventPrice}`;
        Totalprice.innerText = `${eventSelected.eventPrice}`;

        
        const userRef = ref(db, `user/${userUid}/`);
        console.log(userRef)

    book.addEventListener('click', () => {

        const bookingData = {
        // bookingId: bookingIdInput.value,
        modelImage: carSelected.modelImage,
        eventName: eventName.value,
        carName: carName.value,
        driverName: driverName.value,
        DateTo: eventSelected.eventDateTo,
        price: price.value,

     };

        const userRef = ref(db, `user/${userUid}`);

        set(userRef, bookingData)
        .then((snapshot)=>{
            const bookingId = snapshot.uid; // Get the generated key
            const completeBookingData = { // Combine booking ID and data
            bookingId,
            bookingData,
        };

        const userBookingRef = ref(db, `user/${userUid}/${bookingId}`);

        set(userBookingRef, completeBookingData)
            .then(()=> {
                console.log(`Booking data added successfully! Booking ID: ${bookingId}`);
            })
            .catch((error) => {
            console.error('Error setting complete booking data:', error);
            });

        })
            .catch((error) => {
            console.error('Error adding booking data:', error);
            });


    });
    
    

</script>
</body>


</html>