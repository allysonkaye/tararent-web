<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="/styling/style.css">
    <script src="https://kit.fontawesome.com/9339802a43.js" crossorigin="anonymous"></script>
</head>
<style>
    #eventContent {
        display: grid;
        grid-template-columns: auto auto;
        justify-items: center;
    }
    #eventBox {
        display: flex;
        align-items: flex-start;
        flex-direction: column;
        width: 250px;
        border: 0.5px solid grey;
        border-radius: 20px;
        padding: 10px;
        background-color: #FCF9F7;
        
    }
    .event {
        font-size: 25px;
        font-weight: 700;
        color: #0B0806 !important ; 
    }
    #eventBox p {
        margin: 5px;
        color: #373737;
    }
</style>
<body>
    <nav>
        <div class="logo">
            <img class="logoImg" src="/src/tara rent.png" width="50px" height="50px">
         <p class="logoName">TARA RENT</p>
        </div>
        <div class="user">
           <a href="profile.html" target="_self" >
            <i class="fa-regular fa-user fa-2x" style="color: #131415;"> </i>
           </a> 
        </div>
        
    </nav>
    <div class="navbarcont">
        <div class="navBar"> 

            <a href="index.html" target="_self"> <img width="30" height="30" src="https://img.icons8.com/parakeet-line/96/group.png" alt="group"/> </a>
            <a href="status.html" target="_self"> <img src="/src/tara rent.png" width="30px" height="30px"> </a>
            <a href="message.html" target="_self"> <img width="30" height="30" src="https://img.icons8.com/ios/50/chat-message--v1.png" alt="chat-message--v1"/></i> </a>
    
        </div>
    </div>
    <h1 class="pageName"> Carpool Sharing</h1>
    <div id="eventContent">
        <!-- data will display here -->
    </div>
    <h1 id="check"> </h1>
    
    <!-- <script src="https://www.gstatic.com/firebasejs/10.11.1/firebase.js"> </script> -->
    <script type="module">

    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.11.1/firebase-app.js";
    import { getDatabase, ref, onValue, get } from "https://www.gstatic.com/firebasejs/10.11.1/firebase-database.js";


    const firebaseConfig = {
        apiKey: "AIzaSyBAntVFheC4AyJ5n6BGMvZzbfJtisDGafw",
        authDomain: "admintararent.firebaseapp.com",
        databaseURL: "https://admintararent-default-rtdb.asia-southeast1.firebasedatabase.app",
        projectId: "admintararent",
        storageBucket: "admintararent.appspot.com",
        messagingSenderId: "419063988334",
        appId: "1:419063988334:web:c2e91de332e34e53c6267f",
        measurementId: "G-619H3PF5LZ"
    };
    
    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const eventDataRef = ref(db, 'Events');

    //session STORAGE
    const userCreds = JSON.parse(sessionStorage.getItem("user-creds"));
    const userInfo = JSON.parse(sessionStorage.getItem("user-info"));

    const check = document.getElementById("check");

    

    
    

    let CheckCreds = () => {
    if (!sessionStorage.getItem("user-creds")) {
        window.location.href = "login.html";
        // console.log(userCreds);
        // console.log(userInfo);

    }
    else {
        console.log(userCreds);
        // console.log(userInfo);
        // it means it works
        // check.innerHTML = `${userInfo.fullname}`;
        
        // FUNCTIONS
        
        function populateEvent(eventData){
            const eventDataBody = document.getElementById("eventContent");
            eventDataBody.innerHTML = '';
            eventData.forEach(childSnapshot =>{
                const eventData = childSnapshot.val();
                const name = eventData.eventName;
                const venue = eventData.eventVenue;
                const date_to = eventData.eventDateFrom;
                const date_from = eventData.eventDateTo;
                const description = eventData.eventDescription;
                const pickup = eventData.eventPickup;

                const dateToString = new Date(date_to).toDateString().split(' ').slice(1).join(' ');
                const dateFromString = new Date(date_from).toDateString().split(' ').slice(1).join(' ');

                const newDiv = document.createElement('div');
                newDiv.id = "eventBox";
                newDiv.innerHTML =`
                    <p class = "event">${name}</p>
                    <p>${venue}</p>
                    <p>${dateToString}</p>
                    <p>${dateFromString}</p>
                    <p>${pickup}</p>
                `;
                eventDataBody.appendChild(newDiv);
                console.log(eventData)
                newDiv.addEventListener('click', () => {
                    sessionStorage.setItem('Event-selected', JSON.stringify(eventData));
                    window.location.href = "cars.html";
                });
                
                
                // console.log(dateToString)
                // console.log(dateFromString)
            });
        }

        onValue(eventDataRef, (snapshot) =>{
            const eventData = [];
            snapshot.forEach((childSnapshot) => {
                eventData.push(childSnapshot);
            });
            populateEvent(eventData);
            console.log(eventData)
        });
     }
    }

    
    window.addEventListener('load', CheckCreds);

    window.addEventListener('beforeunload', ()=> {
            sessionStorage.setItem("user-creds", JSON.stringify(userCreds));
            sessionStorage.setItem("user-info", JSON.stringify(userInfo));

    });
</script>

</body>
</html>